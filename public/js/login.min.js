/*! cap-website 2014-08-14 */
"use strict";

angular.module("cap.controllers.login", []).controller("PasswordCtrl", [ "$scope", "$element", "$http", "$timeout", "$window", "$cookies", function($scope, $element, $http) {
    $scope.init = function(token) {
        $scope.password = "", $scope.password2 = "", $scope.token = token, $scope.success = !1, 
        $scope.inProgress = !1;
    }, $scope.submitPassword = function() {
        if ($scope.inProgress = !0, console.log($scope.token_value), "" != $scope.password && "" != $scope.password2 && $scope.password === $scope.password2) {
            var params = {
                password: $scope.password,
                password2: $scope.password2,
                token: $scope.token
            };
            $http.post("/password", angular.toJson(params)).success(function(data) {
                data.success ? ($scope.success = !0, $scope.msg = "Password changed successfully", 
                document.location.href = "/dashboard") : ($scope.success = !1, $scope.msg = "Unable to set your password.  Please contact your administrator.", 
                $scope.inProgress = !1);
            }).error(function() {
                $scope.success = !1, $scope.msg = "Unable to set your password.  Please contact your administrator.", 
                $scope.inProgress = !1;
            });
        } else $scope.inProgress = !1, $scope.msg = "Please make sure the passwords match.";
    };
} ]).controller("LoginCtrl", [ "$scope", "$element", "$http", "$timeout", "$window", "$cookies", function($scope, $element, $http, $timeout, $window) {
    $scope.init = function() {
        $scope.email = "", $scope.password = "", $scope.success = !1;
    }, $scope.forgotPassword = function() {
        $scope.is_valid = $scope.validate_form(), $scope.is_valid && (params = {
            email: $scope.email
        }, $http({
            method: "post",
            url: "/user/register",
            data: angular.toJson(params),
            headers: {
                "Content-Type": "application/json"
            }
        }).success(function(data) {
            $scope.msg = "sent" == data.status ? "Your request sent Successfully, Please check your email" : "Some error occured";
        }).error(function() {}));
    }, $scope.submitLogin = function() {
        if (console.log("submit login"), !$scope.loginForm.$pristine) if ($scope.loginForm.$valid) {
            $scope.inProgress = !0, $scope.success = !0, $scope.msg = "Logging in...";
            var params = {
                email: $scope.email,
                password: $scope.password
            };
            $http({
                method: "post",
                url: "/login",
                data: angular.toJson(params),
                headers: {
                    "Content-Type": "application/json"
                }
            }).success(function(data) {
                data.login ? ($scope.inProgress = !1, $timeout(function() {
                    $window.location.href = "/dashboard";
                })) : ($scope.inProgress = !1, $scope.success = !1, $scope.msg = data.msg || "Your email or password was incorrect.");
            }).error(function() {
                $scope.success = !1, $scope.inProgress = !1, $scope.msg = "An internal error ocurred. Please contact your administrator.";
            });
        } else $scope.msg = "Your email or password was incorrect.";
    };
} ]).controller("FooCtrl", [ "$scope", "$window", function() {} ]), angular.module("cap", [ "ngAnimate", "ngCookies", "cap.controllers", "cap.controllers.login", "cap.filters", "cap.router", "cap.services", "cap.directives" ]).config(function($interpolateProvider) {
    $interpolateProvider.startSymbol("[["), $interpolateProvider.endSymbol("]]");
}).config([ function() {} ]).run([ "$rootScope", function() {} ]);