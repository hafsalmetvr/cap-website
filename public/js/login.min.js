/*! cap-website 2014-08-13 */
"use strict";

angular.module("cap.controllers.login", []).controller("LoginCtrl", [ "$scope", "$element", "$http", "$timeout", "$window", "$cookies", function($scope, $element, $http, $timeout, $window, $cookies) {
    $scope.init = function() {
        $scope.email = "", $scope.password = "", $scope.success = !1;
    }, $scope.submitLogin = function() {
        if (console.log("submit login"), !$scope.loginForm.$pristine) if ($scope.loginForm.$valid) {
            $scope.inProgress = !0;
            var params = {
                email: $scope.email,
                password: $scope.password
            };
            $http({
                method: "post",
                url: "/login",
                data: angular.toJson(params),
                headers: {
                    "Content-Type": "application/json"
                }
            }).success(function(data) {
                data.login ? ($scope.success = !0, $scope.msg = "Logging in...", $cookies.user_id = data.uid, 
                $cookies.role_id = data.role_id, $timeout(function() {
                    $window.location.href = "/dashboard", $scope.inProgress = !1;
                })) : $scope.msg = data.msg || "Your email or password was incorrect.";
            }).error(function() {
                $scope.inProgress = !1, $scope.msg = "An internal error ocurred. Please contact your administrator.";
            });
        } else $scope.msg = "Your email or password was incorrect.";
    };
} ]).controller("FooCtrl", [ "$scope", "$window", function() {} ]), angular.module("cap", [ "ngAnimate", "ngCookies", "cap.controllers", "cap.controllers.login", "cap.filters", "cap.router", "cap.services", "cap.directives" ]).config(function($interpolateProvider) {
    $interpolateProvider.startSymbol("[["), $interpolateProvider.endSymbol("]]");
}).config([ "$locationProvider", function() {} ]).run([ "$rootScope", function() {} ]);